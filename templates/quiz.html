{% extends "layout.html" %}

{% block style %}
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" 
  rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='quiz_page.css') }}">
  <style>
    /* Styles pour le bouton "En savoir plus" */
    .explanation-toggle-btn {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 500;
      cursor: pointer;
      margin: 10px auto; /* Centrage avec margin auto */
      display: block; /* Pour que margin auto fonctionne */
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 123, 255, 0.2);
    }
    
    .explanation-toggle-btn:hover {
      background: linear-gradient(135deg, #0056b3, #003d82);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
    }
    
    .explanation-toggle-btn i {
      margin-right: 6px;
    }
    
  /* Styles pour le container d'explication */
  .explanation-container {
    background: linear-gradient(135deg, #f8f9ff, #e8f2ff);
    border: 1px solid #d1e7ff;
    border-radius: 12px;
    margin-top: 15px;
    padding: 0;
    box-shadow: 0 3px 10px rgba(0, 123, 255, 0.1);
    animation: slideDown 0.3s ease-out;
  }
  
  .explanation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    padding: 12px 16px;
    border-radius: 12px 12px 0 0;
    margin: 0;
  }
  
  .explanation-header h5 {
    margin-left: 40%;
    font-size: 1.1em;
    font-weight: 600;
  }
  
  .explanation-header i {
    margin-right: 8px;
    color: #ffd700;
  }
  
  .close-explanation-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
  }
  
  .close-explanation-btn:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }
  
  .explanation-content {
    display :flex;
    justify-content: center;
    padding: 20px;
    color: #333;
    line-height: 1.6;
    font-size: 1em;
  }
  
  /* Animation simple */
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  </style>
{% endblock %}

{% block script %}
  <script src="{{ url_for('static', filename='quizlogic.js') }}"></script>
{% endblock %}

{% block main %}
  <main class="jurisquiz_main">
    <div id="quiztype" hidden>{{type}}</div>
    <div id="matiere" hidden>{{matiere}}</div>
    <div id="author_id" hidden>{{author_id}}</div>
    <div id="quiz_id" hidden>{{quiz_id}}</div>
    <div id="player_id" hidden>{{session.get("user_id")}}</div>
    <h2 id="titre">{{titre}}</h2>
    
    <!-- Barre de progression -->
    <div class="progress-container">
      <div class="progress-header">
        <span class="progress-text">Progression</span>
        <span class="progress-text" id="progress-text">0 / 0</span>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
      </div>
    </div>
    
    <div class="score-container">
      <div class="score-box">Score : <span id="score"></span></div>
      <div class="essais-box">Essais restants : <span id="essais"></span></div>
    </div>
    <div>
      <h1 id="feedback" role="alert"></h1>
      
      <!-- Bouton "En savoir plus" pour afficher l'explication -->
      <button id="show-explanation-btn" class="explanation-toggle-btn" style="display: none;">
        <i class="fas fa-info-circle"></i> En savoir plus
      </button>

      <!-- Div contenant l'explication (masqu√© par d√©faut) -->
      <div id="explanation-container" class="explanation-container" style="display: none;">
        <div class="explanation-header">
          <h5><i class="fas fa-lightbulb"></i> Commentaire </h5>
          <button id="close-explanation-btn" class="close-explanation-btn">&times;</button>
        </div>
        <div id="explanation-content" class="explanation-content"></div>
      </div>
    </div>
    <h4 class="attendu" id="principe"><strong></strong></h4>
    <div class="fin" id="fin" hidden>
      <h3 style="font-weight: 700;">Tu as r√©pondu √† toutes les questions du quiz ! üë®‚Äç‚öñÔ∏è</h3>
      <div style="margin-top: 25px;">
        <h3>Ton score : <span id="final_score"></span></h3>
      </div>
      <div class="restart">
        {% if type == "public" and session.get("user_id") %}
          {% if already_liked %}
            <button id="like-button" class="endbuttons" disabled 
            style="background-color: lightcoral;font-size:1.2em;">
              J'aime d√©j√† ü§ç
            </button>
          {% else %}
            <button id="like-button" class="endbuttons" style="background-color: lightcoral;
          font-size:1.2em;">
              &#x1F90D; Aimer ce Quiz
            </button>
          {% endif %}
        {% endif %}

        <a href="{{ url_for('quiz.quiz', type=type, titre=titre, quiz_id=quiz_id, matiere=matiere, auteur=author_id) }}" 
        class="endbuttons" style="background-color: green;">
          Rejouer ce Quiz
        </a>
        <a href="{{ url_for('quiz.choix', quiz_type=type) }}" class="endbuttons" 
        style="background-color: yellowgreen;">
          Choisir un autre Quiz
        </a>
        <a href="{{ url_for('main.index') }}" class="endbuttons">
          Menu principal
        </a>
      </div>
    </div>
    <div class="noidea" id="les_r√©ponses">
      <div class="reponses">
        <input type="radio" class="choix" name="choix" id="choix1" value="1"/>
        <label id="r1" class="r√©ponse" for="choix1"></label>
      </div>
      <div class="reponses">
        <input type="radio" class="choix" name="choix" id="choix2" value="2"/>
        <label id="r2" class="r√©ponse" for="choix2"></label>
      </div>
      <div class="reponses">
        <input type="radio" class="choix" name="choix" id="choix3" value="3"/>
        <label id="r3" class="r√©ponse" for="choix3"></label>
      </div>
      <div class="reponses">
        <input type="radio" class="choix" name="choix" id="choix4" value="4"/>
        <label id="r4" class="r√©ponse" for="choix4"></label>
      </div>
    </div>
    <button class="suivant" id="suivant" type="submit" value="Suivant">
      Suivant
    </button>
    <span id="question-number"></span>
  </main>
  <script>
      window.quizType = document.getElementById("quiztype").textContent;
      if (window.quizType == "public"){
          window.collectArretsRoute = "{{ url_for('quiz.get_public_questions') }}";
      } else if (window.quizType == "private") {
          window.collectArretsRoute = "{{ url_for('quiz.get_private_questions') }}";
      }
      window.quizlengtherrorRoute = "{{ url_for('quiz.quizlengtherror') }}";
      
      document.addEventListener("DOMContentLoaded", function() {
          likeButton = document.getElementById("like-button");
          likeButton.addEventListener("click", function() {
              const titre = document.querySelector("#titre").textContent;
              const author_id = document.getElementById("author_id").textContent;
              const quiz_id = document.getElementById("quiz_id").textContent;

              fetch("{{ url_for('quiz.like_quiz') }}", {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/json"
                  },
                  body: JSON.stringify({ titre: titre, author_id: author_id, })
              })
              .then(response => response.json())
              .then(data => {
                  if (data.success) {
                      likeButton.textContent = "Merci ! ü§ç";
                      likeButton.disabled = true;
                  } else {
                      alert("Une erreur s'est produite. Veuillez r√©essayer.");
                  }
              });
          });
      });

      function showExplanation() {
    const explanationContainer = document.getElementById('explanation-container');
    const explanationContent = document.getElementById('explanation-content');
    
    if (current_explication && current_explication.trim() !== '') {
        explanationContent.textContent = current_explication;
        explanationContainer.style.display = 'block';
    }
}

function hideExplanation() {
    const explanationContainer = document.getElementById('explanation-container');
    explanationContainer.style.display = 'none';
}
  </script>

{% endblock %}
